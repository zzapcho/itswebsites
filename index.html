<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì•…ë§ˆÂ·ë§ˆë²•Â·ì§€ë ì´ ë¬¸ì¥ ì‹¤í—˜ì‹¤1</title>
  <style>
    :root{
      --bg:#050508;
      --fg:#ececf4;
      --muted:#9a9ab0;
      --line:#232332;
      --card:#0c0c13cc;
      --glow: 0 0 40px rgba(255,255,255,.06);
      --shadow: 0 18px 70px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg);
      background:
        radial-gradient(900px 600px at 18% 26%, rgba(90,40,120,.28) 0%, transparent 55%),
        radial-gradient(900px 600px at 82% 72%, rgba(170,45,70,.23) 0%, transparent 58%),
        radial-gradient(800px 500px at 50% 105%, rgba(20,120,90,.18) 0%, transparent 60%),
        linear-gradient(180deg, #0a0a12, var(--bg));
      overflow:hidden;
      font-family: system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, sans-serif;
      display:flex; align-items:center; justify-content:center;
    }

    /* ì‚´ì§ ì·¨í•œ í”ë“¤ë¦¼ */
    .sway{ animation: sway 6.8s ease-in-out infinite; transform-origin: 50% 55%; }
    @keyframes sway{
      0%{transform: rotate(0deg) translateY(0px)}
      30%{transform: rotate(0.18deg) translateY(-2px)}
      65%{transform: rotate(-0.16deg) translateY(1px)}
      100%{transform: rotate(0deg) translateY(0px)}
    }

    /* ë…¸ì´ì¦ˆ */
    .grain{
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.95' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.28'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity:.075;
    }

    /* ë– ë‹¤ë‹ˆëŠ” ë‹¨ì–´ë“¤ */
    .float{ position:fixed; inset:-20vh -20vw; pointer-events:none; z-index:1; opacity:.22; }
    .float span{
      position:absolute; white-space:nowrap; user-select:none;
      font-size: 13px; letter-spacing:.14em;
      color:#c7c7d6;
      opacity:.55;
      animation: drift linear infinite;
      filter: blur(.15px);
    }
    @keyframes drift{
      from{ transform: translate3d(var(--x0), var(--y0), 0) }
      to  { transform: translate3d(var(--x1), var(--y1), 0) }
    }

    .wrap{
      width:min(980px, 92vw);
      padding:24px;
      position:relative;
      z-index:2;
    }

    .top{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:14px; margin-bottom:14px;
    }
    .brand{ display:flex; flex-direction:column; gap:6px; }
    .title{
      font-size:12px; letter-spacing:.22em; text-transform:uppercase;
      color:var(--muted);
    }
    .subtitle{
      font-size:14px; color:#cfcfe0; opacity:.9;
    }

    .chips{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      border:1px solid var(--line);
      background:#0b0b13aa;
      padding:9px 10px;
      border-radius:999px;
      font-size:12px;
      color:#d9d9e7;
      box-shadow: var(--glow);
      user-select:none;
    }

    .card{
      border:1px solid var(--line);
      background:var(--card);
      backdrop-filter: blur(10px);
      border-radius:20px;
      padding:20px;
      box-shadow: var(--shadow);
    }

    .sentence{
      font-size: clamp(22px, 3.0vw, 40px);
      line-height:1.35;
      letter-spacing:-0.02em;
      white-space:pre-wrap;
      word-break:keep-all;
      opacity:0;
      transform: translateY(10px);
      filter: blur(.25px);
      transition: opacity .38s ease, transform .38s ease, filter .38s ease;
      cursor:pointer;
      user-select:none;
    }
    .sentence.show{
      opacity:1;
      transform: translateY(0);
      filter: blur(0);
    }

    .meta{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color:var(--muted);
      font-size:12px;
    }

    .hud{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }
    @media (max-width: 740px){
      .hud{ grid-template-columns: 1fr; }
    }
    .panel{
      border:1px solid var(--line);
      background:#090910a8;
      border-radius:16px;
      padding:14px 14px 12px;
      box-shadow: var(--glow);
    }
    .panel h3{
      margin:0 0 10px;
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:#bdbdd0;
      font-weight:650;
    }

    .bars{ display:flex; flex-direction:column; gap:10px; }
    .barrow{ display:grid; grid-template-columns: 64px 1fr 44px; gap:10px; align-items:center; }
    .label{ font-size:12px; color:#d9d9e7; opacity:.95; }
    .track{ height:10px; border-radius:999px; border:1px solid var(--line); background:#07070d; overflow:hidden; }
    .fill{ height:100%; width:0%; border-radius:999px; background: linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.22)); transition: width .45s ease; }
    .pct{ font-size:12px; color:#bdbdd0; text-align:right; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      border:1px solid var(--line);
      background:#0a0a12;
      color:var(--fg);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-size:13px;
      box-shadow: var(--glow);
    }
    button:hover{ filter:brightness(1.14); }
    button:active{ transform: translateY(1px); }

    .tiny{
      margin-top:10px;
      font-size:12px;
      color:#a8a8be;
      line-height:1.55;
      opacity:.95;
    }
    kbd{
      border:1px solid var(--line);
      border-bottom-width:2px;
      padding:2px 6px;
      border-radius:7px;
      font-size:11px;
      background:#0a0a12;
      color:#e6e6f2;
    }

    /* í† ìŠ¤íŠ¸ */
    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#0b0b13cc;
      backdrop-filter: blur(10px);
      box-shadow: var(--glow);
      color:var(--fg);
      font-size:13px;
      opacity:0;
      transition: opacity .18s ease;
      z-index:9999;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <div class="grain"></div>
  <div class="float" id="float"></div>
  <div class="toast" id="toast"></div>

  <div class="wrap sway">
    <div class="top">
      <div class="brand">
        <div class="title">sentence lab</div>
        <div class="subtitle">ì•…ë§ˆÂ·ë§ˆë²•Â·ì§€ë ì´ â€” í´ë¦­í• ìˆ˜ë¡ ì„¸ê³„ê´€ì´ ë„ˆ ìª½ìœ¼ë¡œ í•™ìŠµëœë‹¤</div>
      </div>
      <div class="chips">
        <div class="chip" id="moodChip">MOOD: ???</div>
        <div class="chip" id="countChip">#000</div>
      </div>
    </div>

    <div class="card">
      <div id="sentence" class="sentence" title="í´ë¦­í•˜ë©´ ë‹¤ìŒ ë¬¸ì¥"></div>
      <div class="meta">
        <div>í´ë¦­/ìŠ¤í˜ì´ìŠ¤/ì—”í„°: ë‹¤ìŒ Â· <kbd>C</kbd> ë³µì‚¬ Â· <kbd>A</kbd> ì¶”ê°€ Â· <kbd>R</kbd> ë¦¬ì…‹</div>
        <div id="seedInfo">bias: -</div>
      </div>

      <div class="hud">
        <div class="panel">
          <h3>world bias</h3>
          <div class="bars">
            <div class="barrow">
              <div class="label">ì•…ë§ˆ</div>
              <div class="track"><div class="fill" id="barDevil"></div></div>
              <div class="pct" id="pctDevil">0%</div>
            </div>
            <div class="barrow">
              <div class="label">ë§ˆë²•</div>
              <div class="track"><div class="fill" id="barMagic"></div></div>
              <div class="pct" id="pctMagic">0%</div>
            </div>
            <div class="barrow">
              <div class="label">ì§€ë ì´</div>
              <div class="track"><div class="fill" id="barWorm"></div></div>
              <div class="pct" id="pctWorm">0%</div>
            </div>
          </div>
          <div class="tiny">
            ë„ˆê°€ ë¬¸ì¥ì„ ë§ì´ ëˆŒëŸ¬ì„œ ë‚˜ì˜¬ìˆ˜ë¡(=ë§ì´ ë³¸ ë‹¨ì–´ì¼ìˆ˜ë¡) ê·¸ ë‹¨ì–´ê°€ ë” ìì£¼ ë“±ì¥í•¨.<br>
            ì¦‰, ì´ ì‚¬ì´íŠ¸ëŠ” ì ì  â€œë„ˆ ì „ìš© ì´ìƒí•œ ë¬¸ì¥â€ì´ ëœë‹¤.
          </div>
        </div>

        <div class="panel">
          <h3>actions</h3>
          <div class="btns">
            <button id="btnNext">ë‹¤ìŒ(Enter)</button>
            <button id="btnCopy">ë³µì‚¬(C)</button>
            <button id="btnAdd">ë‚´ ë¬¸ì¥ ì¶”ê°€(A)</button>
            <button id="btnReset">ë¦¬ì…‹(R)</button>
          </div>
          <div class="tiny">
            ì¶”ê°€í•œ ë¬¸ì¥ì€ ë¸Œë¼ìš°ì €ì— ì €ì¥ë¨(ë¡œì»¬ ì €ì¥). ì§€ì›Œì§€ì§€ ì•ŠìŒ.<br>
            â€œë¦¬ì…‹â€í•˜ë©´ ì €ì¥ëœ ê²ƒë“¤ê¹Œì§€ ì‹¹ ì´ˆê¸°í™”ë¨.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------------------------
  // 0) ì €ì¥/ë¡œë“œ
  // ---------------------------
  const KEY = {
    lines: "lab_lines_v1",
    clicks: "lab_clicks_v1",
    bias: "lab_bias_v1"
  };

  function load(k, fallback){
    try{
      const v = localStorage.getItem(k);
      return v ? JSON.parse(v) : fallback;
    }catch{ return fallback; }
  }
  function save(k, v){ localStorage.setItem(k, JSON.stringify(v)); }

  // ---------------------------
  // 1) ë¬¸ì¥ ì¬ë£Œ(ì„¸ê³„ê´€)
  // ---------------------------
  const seedLines = [
    "ë‹¹ê·¼ ì‘ ì•…ë§ˆ? ì‘ ë§ˆë²• ì§€ë ì´.",
    "ì‘â€¦ ì–´â€¦ ì–´â€¦.(ìƒê° ë¡œë”©ì¤‘)",
    "ì•…ë§ˆê°€ ë§í–ˆë‹¤: 'ì‘.' ê·¸ë¦¬ê³  ê·¸ê²Œ ëì´ì—ˆë‹¤.",
    "ë§ˆë²•ì€ ìˆì—ˆëŠ”ë°, ì‚¬ìš©ë²•ì´ ì—†ì—ˆë‹¤.",
    "ì§€ë ì´ëŠ” í™ì„ ë¨¹ê³ ë„ ë©€ì©¡í–ˆë‹¤. ë‚˜ëŠ” ë§ì„ ë¨¹ê³  ë¬´ë„ˆì§„ë‹¤.",
    "ë‹¹ê·¼ì€ ë¬´ì£„ë‹¤. ë¬¸ì œëŠ” ë‚´ê°€ ì˜ë¯¸ë¥¼ ì°¾ëŠ” ì†ë„ë‹¤.",
    "ì˜¤ëŠ˜ë„ ì„¸ê³„ëŠ” ì •ìƒì´ê³ , ë‚˜ë§Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨.",
    "ì‘, ê·¼ë° ì™œ ì´ë ‡ê²Œ ë”± ë§ëŠ” ê¸°ë¶„ì´ì§€?",
    "ì•…ë§ˆì™€ ë§ˆë²•ê³¼ ì§€ë ì´ê°€ í•œ í…Œì´ë¸”ì— ì•‰ì•„ ìˆì—ˆë‹¤. ë‚´ê°€ ì´ˆëŒ€í–ˆë‹¤.",
    "ì–´ì©Œë©´ ë‚œ ê·¸ëƒ¥â€¦ ì„¤ëª…ì´ ì•ˆ ë˜ëŠ” íƒ€ì…."
  ];

  const parts = {
    opener: ["ì‘", "ì•„ë‹ˆ", "ì–´..", "ì–´....", "ã…‡ã…‹", "ã…‡ã…‡", "ì ê¹", "ê·¸ë˜", "ëª°ë¼", "ë§ì•„"],
    subject: ["ë‹¹ê·¼", "ìƒˆë²½", "ì²œì¥", "ë°”ë‹¥", "ê·“ì†", "í‚¤ë³´ë“œ", "ì‹¬ì¥", "ë¬¸", "ê±°ìš¸", "ì „íŒŒ"],
    agent: ["ì•…ë§ˆ", "ë§ˆë²•", "ì§€ë ì´", "ì²œì‚¬", "ë²„ê·¸", "ì£¼ë¬¸", "í˜„ì‹¤", "í™˜ê°", "ì•Œê³ ë¦¬ì¦˜", "ê·¸ë¦¼ì"],
    action: ["ì†ì‚­ì˜€ë‹¤", "ì›ƒì—ˆë‹¤", "ì‚¬ë¼ì¡Œë‹¤", "ë‚¨ì•„ìˆì—ˆë‹¤", "ë¶€ì„œì¡Œë‹¤", "ë¶™ì–´ë²„ë ¸ë‹¤", "í˜ëŸ¬ê°”ë‹¤", "ë°”ë€Œì—ˆë‹¤", "ë’¤ì§‘í˜”ë‹¤", "ì ë“¤ì—ˆë‹¤"],
    ending: [
      "ê·¸ë˜ì„œ ë‚œ ê·¸ëƒ¥ {opener}.",
      "ê·¼ë° ì´ìƒí•˜ê²Œë„ ë§ëŠ” ë§ ê°™ë‹¤.",
      "ì´ê±´ ê¿ˆì¸ë° ì €ì¥ì´ ëœë‹¤.",
      "ì„¤ëª…í•˜ë ¤ê³  í•˜ë©´ ë” í‹€ì–´ì§„ë‹¤.",
      "ë‹¤ìŒ ë¬¸ì¥ì— ëª¨ë“  ê±¸ ë§¡ê¸´ë‹¤."
    ]
  };

  const patterns = [
    "{opener}. {subject} ì˜†ì—ì„œ {agent}ê°€ {action}. {ending}",
    "{subject}ëŠ” ë¬´ì£„ê³ , {agent}ê°€ ìœ ì£„ê³ , ë‚œ ëª©ê²©ìë‹¤.",
    "{agent}ê°€ ë‚´ê²Œ ë§í–ˆë‹¤: '{opener}, ì˜¤ëŠ˜ì€ {subject}ë¥¼ ë¯¿ì§€ ë§ˆ.'",
    "ê·œì¹™ 1: {subject}ë¥¼ ì˜ì‹¬í•´.\nê·œì¹™ 2: {agent}ë¥¼ ê³¼ì‹ í•˜ì§€ ë§ˆ.\nê·œì¹™ 3: ê·¸ë˜ë„ {opener}.",
    "{opener}â€¦ ì§€ê¸ˆ {agent}ê°€ ë‚´ ìƒê°ì„ ë¦¬ë¼ì´íŠ¸ ì¤‘.",
    "{subject} ìœ„ì—ì„œ {agent}ê°€ {action}. ë‚˜ëŠ” ë¡œê·¸ë§Œ ë‚¨ê²¼ë‹¤."
  ];

  // ---------------------------
  // 2) 'í•™ìŠµ'ìš© ë°”ì´ì–´ìŠ¤(ê°€ì¤‘ì¹˜)
  // í´ë¦­í• ìˆ˜ë¡ DEVIL/MAGIC/WORM(í•µì‹¬ ë‹¨ì–´)ì˜ í™•ë¥ ì´ ì˜¬ë¼ê°
  // ---------------------------
  const bias = load(KEY.bias, { devil: 1, magic: 1, worm: 1 });
  let clicks = load(KEY.clicks, 0);
  let userLines = load(KEY.lines, []);

  // í•µì‹¬ ë‹¨ì–´ ì‚¬ì „
  const core = {
    devil: ["ì•…ë§ˆ"],
    magic: ["ë§ˆë²•", "ì£¼ë¬¸"],
    worm: ["ì§€ë ì´", "í™"]
  };

  // ---------------------------
  // 3) UI
  // ---------------------------
  const el = {
    sentence: document.getElementById("sentence"),
    toast: document.getElementById("toast"),
    mood: document.getElementById("moodChip"),
    count: document.getElementById("countChip"),
    seedInfo: document.getElementById("seedInfo"),
    barDevil: document.getElementById("barDevil"),
    barMagic: document.getElementById("barMagic"),
    barWorm: document.getElementById("barWorm"),
    pctDevil: document.getElementById("pctDevil"),
    pctMagic: document.getElementById("pctMagic"),
    pctWorm: document.getElementById("pctWorm"),
  };

  // ---------------------------
  // 4) ìœ í‹¸
  // ---------------------------
  const rnd = (n)=> Math.floor(Math.random()*n);
  function pick(arr){ return arr[rnd(arr.length)]; }

  // ê°€ì¤‘ì¹˜ ì„ íƒ(ë£°ë ›)
  function weightedPick(options){
    // options: [{value, weight}, ...]
    const sum = options.reduce((a,o)=>a+o.weight,0);
    let r = Math.random()*sum;
    for(const o of options){
      r -= o.weight;
      if(r <= 0) return o.value;
    }
    return options[options.length-1].value;
  }

  function format(template, map){
    return template.replace(/\{(\w+)\}/g, (_,k)=> map[k] ?? `{${k}}`);
  }

  function toast(msg){
    el.toast.textContent = msg;
    el.toast.style.opacity = "1";
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> el.toast.style.opacity="0", 900);
  }

  function normalizeBias(){
    const total = bias.devil + bias.magic + bias.worm;
    return {
      devil: bias.devil/total,
      magic: bias.magic/total,
      worm: bias.worm/total
    };
  }

  function moodFromBias(n){
    // ì œì¼ í° ê°’ì„ ë¬´ë“œë¡œ
    const entries = Object.entries(n).sort((a,b)=> b[1]-a[1]);
    const top = entries[0][0];
    const pct = Math.round(entries[0][1]*100);
    if(top==="devil") return `MOOD: ì•…ë§ˆ ${pct}% ğŸ˜ˆ`;
    if(top==="magic") return `MOOD: ë§ˆë²• ${pct}% ğŸª„`;
    return `MOOD: ì§€ë ì´ ${pct}% ğŸª±`;
  }

  function updateHUD(){
    const n = normalizeBias();
    el.mood.textContent = moodFromBias(n);
    el.count.textContent = "#" + String(clicks).padStart(3,"0");

    const d = Math.round(n.devil*100);
    const m = Math.round(n.magic*100);
    const w = 100 - d - m;

    el.barDevil.style.width = d + "%";
    el.barMagic.style.width = m + "%";
    el.barWorm.style.width = w + "%";

    el.pctDevil.textContent = d + "%";
    el.pctMagic.textContent = m + "%";
    el.pctWorm.textContent = w + "%";

    el.seedInfo.textContent = `bias: ì•…ë§ˆÃ—${bias.devil.toFixed(1)} / ë§ˆë²•Ã—${bias.magic.toFixed(1)} / ì§€ë ì´Ã—${bias.worm.toFixed(1)}`;
  }

  // ---------------------------
  // 5) ë¬¸ì¥ ìƒì„±(ì§„í™”)
  // ---------------------------
  function generate(){
    // 45%: (seed + user) í’€ì—ì„œ ë½‘ê¸°
    // 55%: ìƒì„±ê¸°ë¡œ ì¡°í•©í•˜ê¸°
    const pool = [...seedLines, ...userLines];

    const mode = weightedPick([
      { value:"pool", weight: 45 },
      { value:"gen",  weight: 55 },
    ]);

    if(mode === "pool" && pool.length){
      const line = pick(pool);
      // í’€ì—ì„œ ë½‘í˜”ì„ ë•Œë„ ë°”ì´ì–´ìŠ¤ ì•½ê°„ í•™ìŠµ(ë“±ì¥ ë‹¨ì–´ ì²´í¬)
      learnFromText(line, 0.18);
      return line;
    }

    // ìƒì„±ê¸°: agent ì„ íƒì— biasë¥¼ ë°˜ì˜
    const agent = weightedPick([
      { value:"ì•…ë§ˆ", weight: bias.devil },
      { value:"ë§ˆë²•", weight: bias.magic },
      { value:"ì§€ë ì´", weight: bias.worm }
    ]);

    // agentì— ë”°ë¼ ì£¼ë³€ ë‹¨ì–´ë„ ì‚´ì§ ë°”ê¾¸ê¸°
    const agentAlt = {
      "ì•…ë§ˆ": ["ì•…ë§ˆ","ë§ë ¹","ê·¸ë¦¼ì","ìœ í˜¹","ê²€ì€ ë†ë‹´"],
      "ë§ˆë²•": ["ë§ˆë²•","ì£¼ë¬¸","ê¸°ì ","ë£¬","ì´ìƒí•œ ê·œì¹™"],
      "ì§€ë ì´": ["ì§€ë ì´","í™","ë¯¸ì„¸í•œ ìƒëª…","ë°”ë‹¥","ë•…ì† ë¹„ë°€"]
    };

    const map = {
      opener: pick(parts.opener),
      subject: pick(parts.subject),
      agent: pick(agentAlt[agent] || parts.agent),
      action: pick(parts.action),
      ending: format(pick(parts.ending), { opener: pick(parts.opener) })
    };

    const sentence = format(pick(patterns), map)
      .replace(/\s{2,}/g, " ")
      .trim();

    // ìƒì„±ê¸° ê²°ê³¼ëŠ” agent ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµ ì¢€ ë” ê°•í•˜ê²Œ
    learnFromCore(agent, 0.28);
    return sentence;
  }

  function learnFromCore(agentWord, amt){
    // í•µì‹¬ ë‹¨ì–´ë¥¼ ë§ì´ ë³¼ìˆ˜ë¡ ê·¸ìª½ biasê°€ ì»¤ì§
    if(agentWord.includes("ì•…ë§ˆ")) bias.devil += amt;
    else if(agentWord.includes("ë§ˆë²•") || agentWord.includes("ì£¼ë¬¸")) bias.magic += amt;
    else if(agentWord.includes("ì§€ë ì´") || agentWord.includes("í™")) bias.worm += amt;
    save(KEY.bias, bias);
  }

  function learnFromText(text, amt){
    // í…ìŠ¤íŠ¸ ì•ˆì— í•µì‹¬ ë‹¨ì–´ê°€ ìˆìœ¼ë©´ bias ë³´ì •
    const t = String(text);
    if(core.devil.some(w=>t.includes(w))) bias.devil += amt;
    if(core.magic.some(w=>t.includes(w))) bias.magic += amt;
    if(core.worm.some(w=>t.includes(w))) bias.worm += amt;
    save(KEY.bias, bias);
  }

  function next(){
    const s = generate();
    clicks++;
    save(KEY.clicks, clicks);

    el.sentence.classList.remove("show");
    setTimeout(()=>{
      el.sentence.textContent = s;
      el.sentence.classList.add("show");
      updateHUD();
    }, 150);
  }

  // ---------------------------
  // 6) ì•¡ì…˜
  // ---------------------------
  function copyCurrent(){
    const t = el.sentence.textContent.trim();
    if(!t) return;
    navigator.clipboard?.writeText(t).then(()=> toast("ë³µì‚¬ë¨"), ()=> fallbackCopy(t));
  }
  function fallbackCopy(text){
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try{ document.execCommand("copy"); toast("ë³µì‚¬ë¨"); }
    catch{ toast("ë³µì‚¬ ì‹¤íŒ¨(ê¶Œí•œ)"); }
    ta.remove();
  }

  function addLine(){
    const input = prompt("ë„ˆì˜ ë¬¸ì¥ì„ ì¶”ê°€í•´ì¤˜ (ì´ìƒí• ìˆ˜ë¡ ì¢‹ìŒ):");
    if(!input) return;
    const line = input.trim();
    if(!line) return;

    userLines.unshift(line);
    userLines = [...new Set(userLines)].slice(0, 250);
    save(KEY.lines, userLines);

    learnFromText(line, 0.35); // ì¶”ê°€í•œ ë¬¸ì¥ì€ ë°”ë¡œ í•™ìŠµ ê°•í•˜ê²Œ
    toast("ë¬¸ì¥ ì¶”ê°€ ì™„ë£Œ");
    next();
  }

  function resetAll(){
    if(!confirm("ì§„ì§œ ë¦¬ì…‹? (ì¶”ê°€ ë¬¸ì¥/í´ë¦­/ë°”ì´ì–´ìŠ¤ ì „ë¶€ ì´ˆê¸°í™”)")) return;
    localStorage.removeItem(KEY.lines);
    localStorage.removeItem(KEY.clicks);
    localStorage.removeItem(KEY.bias);
    userLines = [];
    clicks = 0;
    bias.devil = 1; bias.magic = 1; bias.worm = 1;
    toast("ì´ˆê¸°í™”ë¨");
    updateHUD();
    next();
  }

  // ---------------------------
  // 7) ë°°ê²½ ë‹¨ì–´ ë– ë‹¤ë‹ˆê¸°
  // ---------------------------
  function spawnFloat(){
    const host = document.getElementById("float");
    host.innerHTML = "";
    const n = normalizeBias();

    // biasì— ë”°ë¼ ë– ë‹¤ë‹ˆëŠ” ë‹¨ì–´ ë¹„ìœ¨ë„ ë°”ê¿ˆ
    const words = [];
    for(let i=0;i<18;i++){
      const cat = weightedPick([
        { value:"devil", weight: n.devil },
        { value:"magic", weight: n.magic },
        { value:"worm",  weight: n.worm }
      ]);
      if(cat==="devil") words.push(pick(["ì•…ë§ˆ","ê·¸ë¦¼ì","ìœ í˜¹","ê²€ì€ë§","ì‹¬ì—°"]));
      if(cat==="magic") words.push(pick(["ë§ˆë²•","ì£¼ë¬¸","ë£¬","ê¸°ì ","ì´ìƒí•œ ê·œì¹™"]));
      if(cat==="worm")  words.push(pick(["ì§€ë ì´","í™","ë°”ë‹¥","ë•…ì†","ë¯¸ì„¸í•œ ìƒëª…"]));
    }

    for(const w of words){
      const s = document.createElement("span");
      s.textContent = w;
      const dur = 18 + Math.random()*18;

      s.style.left = (Math.random()*100) + "vw";
      s.style.top  = (Math.random()*100) + "vh";
      s.style.animationDuration = dur + "s";
      s.style.setProperty("--x0", (Math.random()*120-10) + "vw");
      s.style.setProperty("--y0", (Math.random()*120-10) + "vh");
      s.style.setProperty("--x1", (Math.random()*120-10) + "vw");
      s.style.setProperty("--y1", (Math.random()*120-10) + "vh");
      s.style.opacity = (0.25 + Math.random()*0.35).toFixed(2);
      host.appendChild(s);
    }
  }

  // ---------------------------
  // 8) ì´ë²¤íŠ¸
  // ---------------------------
  document.getElementById("btnNext").addEventListener("click", next);
  document.getElementById("btnCopy").addEventListener("click", copyCurrent);
  document.getElementById("btnAdd").addEventListener("click", addLine);
  document.getElementById("btnReset").addEventListener("click", resetAll);
  el.sentence.addEventListener("click", next);

  window.addEventListener("keydown", (e)=>{
    const k = e.key.toLowerCase();
    if(e.key === " " || e.key === "Enter"){ e.preventDefault(); next(); }
    if(k==="c") copyCurrent();
    if(k==="a") addLine();
    if(k==="r") resetAll();
  });

  // ---------------------------
  // 9) ì‹œì‘
  // ---------------------------
  updateHUD();
  spawnFloat();
  next();
  setInterval(spawnFloat, 18000);
</script>
</body>
</html>
